# Analysis Report Template

Template for `.planning/ANALYSIS_REPORT.md` - unified codebase analysis output.

---

## File Template

```markdown
# Codebase Analysis Report

**Project:** [project-name]
**Generated:** [YYYY-MM-DDTHH:MM:SSZ]
**Duration:** [N]s

---

## Executive Summary

**Overall Status:** [HEALTHY | REVIEW_RECOMMENDED | MAINTENANCE_NEEDED | ACTION_REQUIRED | CRITICAL]
**Action Priority:** [NONE | SUGGESTED | RECOMMENDED | URGENT | IMMEDIATE]

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
| Security | [N] | [N] | [N] | [N] |
| Dependencies | [N] | [N] | [N] | [N] |
| Tech Debt | [N] | [N] | [N] | [N] |
| **Total** | **[N]** | **[N]** | **[N]** | **[N]** |

---

## Security Issues

**Status:** [OK | WARNING | HIGH | CRITICAL]
**Priority:** [NONE | REVIEW | URGENT | IMMEDIATE]

### Vulnerabilities

| Severity | Count | Fix Available |
|----------|-------|---------------|
| Critical | [N] | [N] |
| High | [N] | [N] |
| **Total Actionable** | **[N]** | [N] auto-fixable |

### Supply Chain

- **Lockfile validation:** [PASS | FAIL | SKIPPED]

### Recommended Actions

<!-- Include if vulnerabilities found -->
1. **IMMEDIATE:** Run `npm audit fix` to address auto-fixable vulnerabilities
2. Review `npm audit` output for vulnerabilities requiring manual intervention
3. Consider package alternatives for unfixable vulnerabilities

---

## Dependency Issues

**Status:** [OK | ACTION_REQUIRED | CRITICAL]
**Priority:** [NORMAL | HIGH | IMMEDIATE]

### Outdated Packages

| Category | Count |
|----------|-------|
| Major updates available | [N] |
| Minor updates available | [N] |
| Patch updates available | [N] |
| Total outdated | [N] |

### Recommended Actions

<!-- Include if major updates available -->
1. Review changelogs for major version updates
2. Run `npx npm-check-updates -i` for interactive updates
3. Test thoroughly after major version bumps

---

## Tech Debt

**Level:** [CLEAN | LOW | MEDIUM | HIGH]
**Score:** [N]
**Priority:** [NONE | OPTIONAL | SUGGESTED | RECOMMENDED]

### Unused Code

| Category | Count |
|----------|-------|
| Unused files | [N] |
| Unused dependencies | [N] |
| Unused devDependencies | [N] |
| Unused exports | [N] |

### Score Calculation

| Category | Count | Weight | Points |
|----------|-------|--------|--------|
| Unused dependencies | [N] | ×10 | [N] |
| Unused files | [N] | ×5 | [N] |
| Unused exports | [N] | ×2 | [N] |
| Major outdated | [N] | ×3 | [N] |
| **Total** | | | **[N]** |

### Recommended Actions

<!-- Include if MEDIUM or HIGH level -->
1. Remove unused dependencies to reduce install time and attack surface
2. Delete unused files to improve codebase navigability
3. Clean up unused exports when touching affected files

---

## Recommendations for Suggestion Engine

<!-- Phase 12 suggestion engine reads this section -->

### Prioritized Action Items

<!-- Items sorted by priority: CRITICAL > HIGH > MEDIUM > LOW -->

1. **[CRITICAL] Fix critical security vulnerabilities**
   - Count: [N]
   - Effort: quick-fix / moderate / significant
   - Command: `npm audit fix`
   - Goal type: security-fix

2. **[HIGH] Address high-severity vulnerabilities**
   - Count: [N]
   - Effort: moderate
   - Command: `npm audit`
   - Goal type: security-fix

3. **[MEDIUM] Update major version dependencies**
   - Count: [N] packages
   - Effort: significant
   - Command: `npx npm-check-updates -i`
   - Goal type: dependency-update

4. **[MEDIUM] Remove unused dependencies**
   - Count: [N] packages
   - Effort: quick-fix
   - Command: `npm uninstall <packages>`
   - Goal type: tech-debt-cleanup

5. **[LOW] Delete unused files**
   - Count: [N] files
   - Effort: quick-fix
   - Command: Review and delete
   - Goal type: tech-debt-cleanup

---

## Metadata

**Analysis Configuration:**
- jq available: [true | false]
- Knip available: [true | false]
- lockfile-lint available: [true | false]
- Ignore file present: [true | false]

**Tool Outputs:**
- Dependency findings: `.planning/.analysis/dependency-findings.json`
- Security findings: `.planning/.analysis/security-findings.json`
- Tech debt findings: `.planning/.analysis/tech-debt-findings.json`

**Timing:**
- Started: [YYYY-MM-DDTHH:MM:SSZ]
- Completed: [YYYY-MM-DDTHH:MM:SSZ]
- Duration: [N]s

---

*Generated by analyze-codebase orchestrator*
*Report location: .planning/ANALYSIS_REPORT.md*
```

---

## Status Values

### Overall Status

| Status | Meaning | Trigger |
|--------|---------|---------|
| `HEALTHY` | No significant issues | All analyzers report OK/CLEAN |
| `REVIEW_RECOMMENDED` | Minor issues present | Warnings or low-level findings |
| `MAINTENANCE_NEEDED` | Tech debt accumulating | High tech debt score |
| `ACTION_REQUIRED` | Security issues need attention | High-severity vulnerabilities |
| `CRITICAL` | Immediate action required | Critical vulnerabilities |

### Action Priority

| Priority | Meaning | Recommended Response |
|----------|---------|----------------------|
| `NONE` | No action needed | Continue normal work |
| `SUGGESTED` | Optional improvements | Address when convenient |
| `RECOMMENDED` | Should be addressed | Plan for next maintenance cycle |
| `URGENT` | Address soon | Prioritize in current sprint |
| `IMMEDIATE` | Block other work | Fix before continuing |

---

## Goal Types for Suggestion Engine

The suggestion engine (Phase 12) uses goal types to categorize and route proposals:

| Goal Type | Description | Typical Actions |
|-----------|-------------|-----------------|
| `security-fix` | Security vulnerability remediation | npm audit fix, package updates |
| `dependency-update` | Package version updates | npm-check-updates, manual updates |
| `tech-debt-cleanup` | Code maintenance | Remove unused code, refactor |

---

## Effort Estimates

| Effort | Meaning | Typical Duration |
|--------|---------|------------------|
| `quick-fix` | Single command or small change | < 30 minutes |
| `moderate` | Multiple changes, some testing | 30 min - 2 hours |
| `significant` | Major updates, breaking changes | 2+ hours, may span sessions |

---

## Contract: Phase 11 → Phase 12

This template defines the contract between:
- **Phase 11 (Codebase Analysis)**: Produces ANALYSIS_REPORT.md
- **Phase 12 (Suggestion Engine)**: Reads and processes recommendations

### Required Fields for Suggestion Engine

The suggestion engine expects these fields in "Recommendations for Suggestion Engine":

```markdown
N. **[PRIORITY] Action description**
   - Count: [N]
   - Effort: [quick-fix | moderate | significant]
   - Command: `<command>`
   - Goal type: [security-fix | dependency-update | tech-debt-cleanup]
```

### Parsing Example

```bash
# Extract prioritized items
grep -E '^\d+\. \*\*\[' .planning/ANALYSIS_REPORT.md

# Count critical items
grep -c '\[CRITICAL\]' .planning/ANALYSIS_REPORT.md

# Extract goal types
grep -oE 'Goal type: [a-z-]+' .planning/ANALYSIS_REPORT.md | cut -d' ' -f3
```

---

## Guidelines

<guidelines>

### When Created

This file is created by the `analyze-codebase.md` workflow when:
- User runs `/gsd:analyze-codebase` command
- CI/CD pipeline triggers analysis
- Manual workflow execution

### Location

Always at `.planning/ANALYSIS_REPORT.md` in the project root.

### Freshness

The report represents a point-in-time snapshot. It should be regenerated:
- Before starting significant work
- After dependency changes
- Before milestone completion
- When security advisories are published

### Interpretation

**Priority hierarchy:**
1. CRITICAL security → Fix immediately, block other work
2. HIGH security → Fix soon, may block merges
3. MEDIUM (deps/debt) → Schedule for maintenance
4. LOW (cleanup) → Nice to have, address opportunistically

**Score thresholds (tech debt):**
- 0: CLEAN - No detected tech debt
- 1-49: LOW - Minor cleanup opportunities
- 50-99: MEDIUM - Should address in maintenance cycle
- 100+: HIGH - Significant debt requiring attention

### Customization

Projects can customize analysis behavior via:
- `.codebase-analysis-ignore` - Exclude paths from analysis
- `knip.json` - Configure dead code detection
- Future: `.gsd/analysis-config.json` for thresholds

</guidelines>

---

## Examples

### Example 1: Healthy Project

```markdown
## Executive Summary

**Overall Status:** HEALTHY
**Action Priority:** NONE

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
| Security | 0 | 0 | 0 | 0 |
| Dependencies | 0 | 0 | 2 | 5 |
| Tech Debt | 0 | 0 | 0 | 3 |
| **Total** | **0** | **0** | **2** | **8** |
```

### Example 2: Critical Security Issue

```markdown
## Executive Summary

**Overall Status:** CRITICAL
**Action Priority:** IMMEDIATE

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
| Security | 1 | 3 | 2 | 0 |
| Dependencies | 0 | 0 | 4 | 8 |
| Tech Debt | 0 | 0 | 2 | 5 |
| **Total** | **1** | **3** | **8** | **13** |
```

### Example 3: High Tech Debt

```markdown
## Executive Summary

**Overall Status:** MAINTENANCE_NEEDED
**Action Priority:** RECOMMENDED

| Category | Critical | High | Medium | Low |
|----------|----------|------|--------|-----|
| Security | 0 | 0 | 0 | 0 |
| Dependencies | 0 | 0 | 6 | 12 |
| Tech Debt | 0 | 0 | 8 | 25 |
| **Total** | **0** | **0** | **14** | **37** |

## Tech Debt

**Level:** HIGH
**Score:** 142
```

---

*Template for GSD codebase analysis reports*
