---
phase: 02-user-autonomy
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - /Users/macuser/.claude/agents/gsd-executor.md
  - /Users/macuser/.claude/get-shit-done/references/user-autonomy.md
autonomous: true

must_haves:
  truths:
    - "User sets git.auto_commit: false — executor stages changes and prompts instead of auto-committing"
    - "User sets safety.verify_interfaces: false — executor skips interface verification without error"
    - "User sets safety.verify_requirements: false — executor skips requirements verification without error"
    - "When toggles are false, executor echoes a warning so user knows what was skipped"
    - "When toggles are true (default), behavior is identical to current behavior"
    - "Reference doc explains what each toggle does and when to disable it"
  artifacts:
    - path: "/Users/macuser/.claude/agents/gsd-executor.md"
      provides: "Config-aware executor that checks git.auto_commit, safety.verify_interfaces, safety.verify_requirements"
      contains: "STRONGLY RECOMMENDED"
    - path: "/Users/macuser/.claude/get-shit-done/references/user-autonomy.md"
      provides: "Documentation of all autonomy toggles"
      contains: "git.auto_commit"
  key_links:
    - from: ".planning/config.json git.auto_commit"
      to: "gsd-executor.md task_commit_protocol"
      via: "Bash grep reads config value, if false skips git commit and stages only"
      pattern: "AUTO_COMMIT.*auto_commit"
    - from: ".planning/config.json safety.verify_interfaces"
      to: "gsd-executor.md verify_interfaces step"
      via: "Bash grep reads config value, if false skips step with warning"
      pattern: "VERIFY_INTERFACES.*verify_interfaces"
    - from: ".planning/config.json safety.verify_requirements"
      to: "gsd-executor.md verify_requirement_coverage step"
      via: "Bash grep reads config value, if false skips step with warning"
      pattern: "VERIFY_REQUIREMENTS.*verify_requirements"
---

<objective>
Modify executor to respect config toggles and create reference documentation

Purpose: Make the executor honor user preferences for auto-commit and safety verification steps. When toggles are disabled, executor skips the step with a clear warning rather than silently proceeding or erroring. Reference doc ensures users understand what each toggle controls.

Output: Updated gsd-executor.md with config-aware verify_interfaces, verify_requirement_coverage, and task_commit_protocol steps. New user-autonomy.md reference doc.
</objective>

<execution_context>
@/Users/macuser/.claude/get-shit-done/workflows/execute-plan.md
@/Users/macuser/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-user-autonomy/02-RESEARCH.md
@.planning/phases/02-user-autonomy/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make executor verify_interfaces and verify_requirement_coverage config-aware</name>
  <files>/Users/macuser/.claude/agents/gsd-executor.md</files>
  <action>
Make 2 edits to gsd-executor.md. Both follow the same pattern: add a config check at the top of each step, and soften the NON-NEGOTIABLE language.

**Edit 1 — verify_interfaces step (around lines 72-101):**

At the BEGINNING of the `<step name="verify_interfaces" priority="critical">` section (right after the opening tag), insert a config check block:

```markdown
**Config check:**

```bash
VERIFY_INTERFACES=$(cat .planning/config.json 2>/dev/null | grep -o '"verify_interfaces"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")
```

If `VERIFY_INTERFACES` is `false`:
- Echo: "Interface verification DISABLED (safety.verify_interfaces: false)"
- Echo: "  Proceeding without verification. Ensure interfaces are correct."
- Skip the rest of this step.
```

Then at the END of the step (line 100), replace:

```
**This step is NON-NEGOTIABLE.** Interface verification failures have caused critical bugs in production. Always verify before writing dependent code.
```

With:

```
**This step is STRONGLY RECOMMENDED.** Interface verification failures have caused critical bugs in production. Always verify before writing dependent code. This step can be disabled via `safety.verify_interfaces: false` in `.planning/config.json` for rapid prototyping or when interfaces are well-known.
```

**Edit 2 — verify_requirement_coverage step (around lines 103-148):**

At the BEGINNING of the `<step name="verify_requirement_coverage" priority="critical">` section (right after the opening tag), insert the same pattern:

```markdown
**Config check:**

```bash
VERIFY_REQUIREMENTS=$(cat .planning/config.json 2>/dev/null | grep -o '"verify_requirements"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")
```

If `VERIFY_REQUIREMENTS` is `false`:
- Echo: "Requirement verification DISABLED (safety.verify_requirements: false)"
- Echo: "  Proceeding without verification. Ensure requirements are met."
- Skip the rest of this step.
```

Then at the END of the step (line 148), replace:

```
**This step is NON-NEGOTIABLE.** Requirement verification failures have caused repeated user-facing bugs. Always verify requirement text literally before marking tasks complete.
```

With:

```
**This step is STRONGLY RECOMMENDED.** Requirement verification failures have caused repeated user-facing bugs. Always verify requirement text literally before marking tasks complete. This step can be disabled via `safety.verify_requirements: false` in `.planning/config.json` for rapid prototyping or when requirements are simple.
```

IMPORTANT: Use the Read tool to find exact text before each edit. The line numbers above are approximate — match on actual text content.
  </action>
  <verify>
1. Read gsd-executor.md — search for "VERIFY_INTERFACES" — confirm config check block exists in verify_interfaces step
2. Search for "VERIFY_REQUIREMENTS" — confirm config check block exists in verify_requirement_coverage step
3. Search for "NON-NEGOTIABLE" — should return ZERO matches (all replaced with "STRONGLY RECOMMENDED")
4. Search for "STRONGLY RECOMMENDED" — should return exactly 2 matches (one per step)
5. Confirm both config checks use `|| echo "true"` fallback (backward compatible)
6. Confirm both have "DISABLED" echo messages when toggle is false
  </verify>
  <done>Executor respects safety.verify_interfaces and safety.verify_requirements config toggles. NON-NEGOTIABLE language replaced with STRONGLY RECOMMENDED. When disabled, executor echoes warning and skips step. Covers AUTO-03, AUTO-04.</done>
</task>

<task type="auto">
  <name>Task 2: Make executor task_commit_protocol config-aware</name>
  <files>/Users/macuser/.claude/agents/gsd-executor.md</files>
  <action>
Make 1 edit to the `<task_commit_protocol>` section (around lines 628-685).

**Edit 1 — Add config check at the beginning of task_commit_protocol:**

Right after the opening `<task_commit_protocol>` tag and the line "After each task completes (verification passed, done criteria met), commit immediately.", insert:

```markdown
**Config check:**

```bash
AUTO_COMMIT=$(cat .planning/config.json 2>/dev/null | grep -o '"auto_commit"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")
```

If `AUTO_COMMIT` is `false`:
- Still stage files (steps 1-2 below) so the user can review what changed
- Skip the commit (step 4)
- Echo: "Task complete: Changes staged (not committed)"
- Echo: "  Review with: git diff --staged"
- Echo: "  Commit with: git commit -m 'your message'"
- Set `TASK_COMMIT="staged"` (for SUMMARY.md tracking)
- Skip to next task
```

Then update step **5. Record commit hash** (around line 671-677) to handle staged state:

Replace:
```markdown
**5. Record commit hash:**

```bash
TASK_COMMIT=$(git rev-parse --short HEAD)
```

Track for SUMMARY.md generation.
```

With:
```markdown
**5. Record commit hash:**

```bash
if [ "$AUTO_COMMIT" = "true" ]; then
  TASK_COMMIT=$(git rev-parse --short HEAD)
else
  TASK_COMMIT="staged"
fi
```

Track for SUMMARY.md generation. When `AUTO_COMMIT` is false, hash is "staged" — user must commit manually.
```

IMPORTANT: Use the Read tool to find exact text before each edit. Match on actual content, not line numbers.
  </action>
  <verify>
1. Read gsd-executor.md — search for "AUTO_COMMIT" — confirm config check exists in task_commit_protocol
2. Confirm "Changes staged (not committed)" message exists
3. Confirm the commit hash section handles the `staged` case
4. Confirm the `|| echo "true"` fallback ensures backward compatibility
5. Confirm steps 1-2 (identify + stage files) still run regardless of toggle
  </verify>
  <done>Executor respects git.auto_commit config toggle. When false, stages files and prompts user to commit manually. When true (default), behavior unchanged. Covers AUTO-01.</done>
</task>

<task type="auto">
  <name>Task 3: Create user autonomy reference doc</name>
  <files>/Users/macuser/.claude/get-shit-done/references/user-autonomy.md</files>
  <action>
Create a NEW file at `/Users/macuser/.claude/get-shit-done/references/user-autonomy.md` with the following content:

```markdown
# User Autonomy Reference

GSD provides configurable toggles that let users control framework behavior. All toggles default to `true` (current behavior preserved). Change via `/gsd:settings` or edit `.planning/config.json` directly.

## Git Toggles

### `git.auto_commit`

| | |
|---|---|
| **Default** | `true` |
| **Location** | `.planning/config.json` > `git.auto_commit` |
| **What it controls** | Whether GSD auto-commits after each completed task |

**When `true` (default):**
- Executor commits each task immediately after verification passes
- Produces atomic commits with standardized messages (`feat(02-01): ...`)
- Enables git bisect and per-task revert

**When `false`:**
- Executor stages files but does NOT commit
- Echoes: "Changes staged (not committed)"
- User reviews with `git diff --staged` and commits manually
- SUMMARY.md records commit hash as "staged"

**When to disable:**
- You want to review all changes before committing
- You prefer custom commit messages
- You want to squash multiple tasks into a single commit
- You are debugging and want to discard changes easily

## Safety Toggles

### `safety.verify_interfaces`

| | |
|---|---|
| **Default** | `true` |
| **Location** | `.planning/config.json` > `safety.verify_interfaces` |
| **What it controls** | Whether executor reads and verifies external interfaces (DB schemas, API endpoints, type definitions) before writing dependent code |

**When `true` (default):**
- Executor reads migration files, schema definitions, and type exports before writing code that depends on them
- Catches interface mismatches before runtime (wrong column names, missing fields, type errors)
- Adds ~2-5 minutes per task with interface dependencies

**When `false`:**
- Executor skips interface verification entirely
- Echoes warning: "Interface verification DISABLED"
- Code may reference incorrect schemas, types, or API shapes
- Runtime errors become more likely

**When to disable:**
- Rapid prototyping where interfaces are fluid and will change
- Small projects where you know all interfaces by heart
- Tasks with no external interface dependencies

### `safety.verify_requirements`

| | |
|---|---|
| **Default** | `true` |
| **Location** | `.planning/config.json` > `safety.verify_requirements` |
| **What it controls** | Whether executor verifies each task satisfies its mapped requirements literally before marking complete |

**When `true` (default):**
- Executor reads requirement text from REQUIREMENTS.md
- Parses keywords (or/and/all) to verify every component is satisfied
- Catches partial implementations (e.g., "search by name or content" but only name is implemented)

**When `false`:**
- Executor skips requirement verification
- Echoes warning: "Requirement verification DISABLED"
- Tasks may be marked complete without satisfying all requirement components
- Gap closure plans may be needed later

**When to disable:**
- Exploratory work where requirements are not yet defined
- Phases without formal requirements (infrastructure, refactoring)
- When requirements are simple enough that verification is overhead

## Existing Safety Toggles

These toggles existed before Phase 2 and are documented here for completeness:

### `safety.always_confirm_destructive`
- **Default:** `true`
- Prompts user before destructive operations (database drops, file deletions)

### `safety.always_confirm_external_services`
- **Default:** `true`
- Prompts user before calling external APIs or services

## Configuration Example

```json
{
  "git": {
    "auto_commit": false
  },
  "safety": {
    "always_confirm_destructive": true,
    "always_confirm_external_services": true,
    "verify_interfaces": true,
    "verify_requirements": false
  }
}
```

This configuration stages changes for manual commit, keeps destructive/external confirmations, keeps interface verification, but skips requirement verification (useful for exploratory phases).

---
*Reference: user-autonomy*
*Created: Phase 02 - User Autonomy*
*See also: /gsd:settings, .planning/config.json*
```

This is a NEW file — use the Write tool to create it.
  </action>
  <verify>
1. Read the new file at references/user-autonomy.md
2. Confirm it documents git.auto_commit, safety.verify_interfaces, safety.verify_requirements
3. Confirm it includes "When to disable" sections for each toggle
4. Confirm it includes a configuration example
5. Confirm it references existing safety toggles for completeness
  </verify>
  <done>Reference doc explains all autonomy toggles, their defaults, behavior when enabled/disabled, and when a user might want to change them. Covers AUTO-06.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Read gsd-executor.md — search for "NON-NEGOTIABLE" — expect ZERO matches
2. Read gsd-executor.md — search for "STRONGLY RECOMMENDED" — expect 2 matches
3. Read gsd-executor.md — search for "AUTO_COMMIT" — expect matches in task_commit_protocol
4. Read gsd-executor.md — search for "VERIFY_INTERFACES" — expect match in verify_interfaces step
5. Read gsd-executor.md — search for "VERIFY_REQUIREMENTS" — expect match in verify_requirement_coverage step
6. Read references/user-autonomy.md — confirm it exists and documents all 3 new toggles
7. Verify backward compatibility: all config checks use `|| echo "true"` fallback
</verification>

<success_criteria>
- git.auto_commit: false causes executor to stage without committing (AUTO-01)
- safety.verify_interfaces: false causes executor to skip interface verification with warning (AUTO-03)
- safety.verify_requirements: false causes executor to skip requirement verification with warning (AUTO-04)
- NON-NEGOTIABLE language replaced with STRONGLY RECOMMENDED in both steps
- All defaults are true (backward compatible)
- Reference doc exists explaining all toggles (AUTO-06)
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-autonomy/02-02-SUMMARY.md`
</output>
