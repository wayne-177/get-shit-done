---
phase: 02-user-autonomy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/macuser/.claude/get-shit-done/templates/config.json
  - /Users/macuser/.claude/get-shit-done/lib/validate-config.md
  - /Users/macuser/.claude/commands/gsd/settings.md
autonomous: true

must_haves:
  truths:
    - "/gsd:settings includes auto-commit preference as a configurable question"
    - "/gsd:settings includes verify-interfaces preference as a configurable question"
    - "/gsd:settings includes verify-requirements preference as a configurable question"
    - "Config template includes git.auto_commit and safety.verify_* fields with true defaults"
    - "Validation schema accepts git.auto_commit, safety.verify_interfaces, safety.verify_requirements as booleans"
  artifacts:
    - path: "/Users/macuser/.claude/get-shit-done/templates/config.json"
      provides: "Default config with git and extended safety sections"
      contains: "auto_commit"
    - path: "/Users/macuser/.claude/get-shit-done/lib/validate-config.md"
      provides: "Validation for git.auto_commit, safety.verify_interfaces, safety.verify_requirements"
      contains: "verify_interfaces"
    - path: "/Users/macuser/.claude/commands/gsd/settings.md"
      provides: "Settings UI with auto-commit and safety toggle questions"
      contains: "Auto-commit"
  key_links:
    - from: "config.json git.auto_commit field"
      to: "settings.md auto-commit question"
      via: "AskUserQuestion reads current value, writes back to config"
      pattern: "auto_commit"
    - from: "config.json safety.verify_* fields"
      to: "validate-config.md validation function"
      via: "checkType calls for new boolean fields"
      pattern: "verify_interfaces.*boolean"
---

<objective>
Add git and safety config toggles to config template, validation schema, and settings UI

Purpose: Establish the configuration foundation that the executor will read in Plan 02. Users must be able to discover and change these toggles via /gsd:settings before the executor respects them.

Output: Updated config template with git.auto_commit and safety.verify_* fields, extended validation schema, and settings command with 3 new questions (7 total).
</objective>

<execution_context>
@/Users/macuser/.claude/get-shit-done/workflows/execute-plan.md
@/Users/macuser/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-user-autonomy/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add git and safety toggle fields to config template and validation</name>
  <files>
    /Users/macuser/.claude/get-shit-done/templates/config.json
    /Users/macuser/.claude/get-shit-done/lib/validate-config.md
  </files>
  <action>
**Edit 1 — Config template (`templates/config.json`):**

Add a `"git"` section after the existing `"safety"` section. Also add `verify_interfaces` and `verify_requirements` to the existing `"safety"` section. The result should look like:

```json
  "safety": {
    "always_confirm_destructive": true,
    "always_confirm_external_services": true,
    "verify_interfaces": true,
    "verify_requirements": true
  },
  "git": {
    "auto_commit": true
  }
```

All new fields default to `true` to maintain backward compatibility (existing behavior unchanged).

**Edit 2 — Validation schema definition table (`validate-config.md`):**

In the `### Safety Section` table, add two new rows after the existing fields:

```
| `safety.verify_interfaces` | boolean | No |
| `safety.verify_requirements` | boolean | No |
```

After each new row, add a description line below the table (or as a note under the Safety Section heading) explaining what these fields control:

```markdown
**Field descriptions:**

- `safety.verify_interfaces` — When `true` (default), the executor reads and verifies external interfaces (DB schemas, API endpoints, type definitions) before writing dependent code. When `false`, the executor skips interface verification entirely and echoes a warning. Disable for rapid prototyping or when interfaces are well-known.
- `safety.verify_requirements` — When `true` (default), the executor verifies each task satisfies its mapped requirements literally before marking complete. When `false`, the executor skips requirement verification and echoes a warning. Disable for exploratory work or phases without formal requirements.
```

After the `### Adaptive Section` table, add a new section:

```markdown
### Git Section

| Field | Type | Required |
|-------|------|----------|
| `git.auto_commit` | boolean | No |

**Field descriptions:**

- `git.auto_commit` — When `true` (default), the executor auto-commits after each completed task with a standardized message. When `false`, the executor stages files but does NOT commit, prompting the user to review and commit manually. Disable when you want to review changes before committing or prefer custom commit messages.
```

**Edit 3 — Validation function (`validate-config.md`):**

Inside the existing `// Safety section` block (after the `always_confirm_external_services` check), add:

```javascript
      checkType(config.safety.verify_interfaces, 'boolean', 'safety.verify_interfaces');
      checkType(config.safety.verify_requirements, 'boolean', 'safety.verify_requirements');
```

After the `// Adaptive section` block (before `return errors;`), add a new block:

```javascript
  // Git section
  if (config.git !== undefined) {
    if (checkType(config.git, 'object', 'git')) {
      checkType(config.git.auto_commit, 'boolean', 'git.auto_commit');
    }
  }
```

IMPORTANT: Use the Read tool to find exact text before each edit. Match on actual content, not line numbers.
  </action>
  <verify>
1. Read templates/config.json — confirm `"git": { "auto_commit": true }` exists and `safety` has `verify_interfaces` and `verify_requirements` fields
2. Read validate-config.md — confirm schema table has Git Section with `git.auto_commit`
3. Read validate-config.md — confirm **Field descriptions** section exists under Safety Section explaining what `verify_interfaces` and `verify_requirements` control (not just type validation)
4. Read validate-config.md — confirm **Field descriptions** section exists under Git Section explaining what `git.auto_commit` controls
5. Read validate-config.md — confirm validation function has `// Git section` block and `verify_interfaces`/`verify_requirements` checks in safety section
6. Confirm all new fields default to `true`
  </verify>
  <done>Config template has git.auto_commit and safety.verify_* fields with true defaults. Validation schema accepts all new fields as optional booleans. Covers AUTO-05.</done>
</task>

<task type="auto">
  <name>Task 2: Add auto-commit and safety toggle questions to settings command</name>
  <files>/Users/macuser/.claude/commands/gsd/settings.md</files>
  <action>
**Edit 1 — Add 3 new AskUserQuestion entries:**

In the `## 3. Present Settings` section, after the existing 4th question (Execution Verifier), add 3 new questions inside the AskUserQuestion array:

```markdown
  {
    question: "Auto-commit after each task?",
    header: "Git: Auto-Commit",
    multiSelect: false,
    options: [
      { label: "Yes (Recommended)", description: "Atomic commits for each completed task" },
      { label: "No", description: "Stage changes and prompt — you commit manually" }
    ]
  },
  {
    question: "Verify interfaces before writing code?",
    header: "Safety: Interface Verification",
    multiSelect: false,
    options: [
      { label: "Yes (Strongly Recommended)", description: "Read schemas/types before writing dependent code" },
      { label: "No", description: "Skip interface verification — faster but riskier" }
    ]
  },
  {
    question: "Verify requirements before marking tasks complete?",
    header: "Safety: Requirement Verification",
    multiSelect: false,
    options: [
      { label: "Yes (Strongly Recommended)", description: "Check requirement text literally before completion" },
      { label: "No", description: "Skip requirement verification — faster but may miss coverage" }
    ]
  }
```

**Edit 2 — Add response-to-boolean mapping logic:**

After the 3 new AskUserQuestion entries, add a parsing note in the settings command that maps user responses to config values:

```markdown
**Response parsing for new questions:**

Map AskUserQuestion responses to boolean config values:
- Response label starts with "Yes" → `true` (matches "Yes (Recommended)" and "Yes (Strongly Recommended)")
- Response label starts with "No" → `false`

Apply to all 3 new questions:
- Auto-commit response → `git.auto_commit`: true/false
- Interface Verification response → `safety.verify_interfaces`: true/false
- Requirement Verification response → `safety.verify_requirements`: true/false
```

**Edit 3 — Update config parsing in Step 2:**

After the existing parsed values list (workflow.research, workflow.plan_check, workflow.verifier, model_profile), add:

```markdown
- `git.auto_commit` — auto-commit after each task (default: `true`)
- `safety.verify_interfaces` — verify interfaces before coding (default: `true`)
- `safety.verify_requirements` — verify requirements before completion (default: `true`)
```

**Edit 4 — Update config merge in Step 4:**

Update the JSON merge example to include the new sections:

```json
{
  ...existing_config,
  "model_profile": "quality" | "balanced" | "budget",
  "workflow": {
    "research": true/false,
    "plan_check": true/false,
    "verifier": true/false
  },
  "git": {
    "auto_commit": true/false
  },
  "safety": {
    ...existing_safety,
    "verify_interfaces": true/false,
    "verify_requirements": true/false
  }
}
```

**Edit 5 — Update confirmation display in Step 5:**

Add 3 new rows to the settings table:

```
| Auto-Commit          | {On/Off} |
| Interface Verify     | {On/Off} |
| Requirement Verify   | {On/Off} |
```

**Edit 6 — Update success criteria:**

Change `- [ ] User presented with 4 settings (profile + 3 toggles)` to:
`- [ ] User presented with 7 settings (profile + 3 workflow toggles + 1 git toggle + 2 safety toggles)`

IMPORTANT: Use the Read tool to find exact text before each edit. Match on actual content, not line numbers.
  </action>
  <verify>
1. Read settings.md — confirm AskUserQuestion block has 7 questions total (4 existing + 3 new)
2. Confirm response-to-boolean mapping logic exists: "Yes" prefix maps to `true`, "No" prefix maps to `false`
3. Confirm mapping covers all 3 new questions (auto_commit, verify_interfaces, verify_requirements)
4. Confirm Step 2 parsing lists `git.auto_commit`, `safety.verify_interfaces`, `safety.verify_requirements`
5. Confirm Step 4 merge includes `"git"` and updated `"safety"` sections
6. Confirm Step 5 table has 7 rows
7. Confirm success criteria says "7 settings"
  </verify>
  <done>/gsd:settings includes auto-commit, verify-interfaces, and verify-requirements as configurable questions. Covers AUTO-02.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Read templates/config.json — confirm git and extended safety sections exist
2. Read validate-config.md — search for "git.auto_commit" and "verify_interfaces" in both schema table and validation function
3. Read settings.md — count AskUserQuestion entries (expect 7), verify config merge includes git section
4. Confirm backward compatibility: all new toggles default to `true` (existing behavior unchanged)
</verification>

<success_criteria>
- Config template has git.auto_commit and safety.verify_* fields defaulting to true (AUTO-05)
- Validation schema accepts all new fields as optional booleans (AUTO-05)
- /gsd:settings presents auto-commit question (AUTO-02)
- /gsd:settings presents verify-interfaces and verify-requirements questions
- All defaults maintain backward compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-autonomy/02-01-SUMMARY.md`
</output>
