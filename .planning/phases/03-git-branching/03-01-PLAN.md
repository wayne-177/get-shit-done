---
phase: 03-git-branching
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/macuser/.claude/get-shit-done/templates/config.json
  - /Users/macuser/.claude/get-shit-done/lib/validate-config.md
  - /Users/macuser/.claude/commands/gsd/settings.md
autonomous: true

must_haves:
  truths:
    - "Running /gsd:settings shows a 'Git Branching' question with None/Per Phase/Per Milestone options"
    - "Selecting 'Per Phase' writes branching_strategy: phase to config.json git section"
    - "Selecting 'Per Milestone' writes branching_strategy: milestone to config.json git section"
    - "Config validation accepts branching_strategy as an enum string (none/phase/milestone)"
    - "Config validation rejects invalid branching_strategy values"
    - "Default branching_strategy is none when not present in config"
  artifacts:
    - path: "/Users/macuser/.claude/get-shit-done/templates/config.json"
      provides: "git.branching_strategy field with none default"
      contains: "branching_strategy"
    - path: "/Users/macuser/.claude/get-shit-done/lib/validate-config.md"
      provides: "Enum validation for branching_strategy"
      contains: "branching_strategy"
    - path: "/Users/macuser/.claude/commands/gsd/settings.md"
      provides: "Git Branching strategy question in settings UI"
      contains: "branching_strategy"
  key_links:
    - from: "/Users/macuser/.claude/commands/gsd/settings.md"
      to: ".planning/config.json"
      via: "AskUserQuestion response → config merge"
      pattern: "branching_strategy.*none.*phase.*milestone"
    - from: "/Users/macuser/.claude/get-shit-done/lib/validate-config.md"
      to: "git.branching_strategy"
      via: "checkEnum validation"
      pattern: "none.*phase.*milestone"
---

<objective>
Add git.branching_strategy enum config field to template, validation, and settings UI.

Purpose: Extends the config infrastructure (established in Phase 2) with branching strategy selection, following the same 3-step pattern: template → validation → settings UI. This gives users a way to choose none/phase/milestone branching before Plan 02 adds execution logic.

Output: Config template with branching_strategy field, validation with enum checking, settings UI with 8th question for branching strategy selection.
</objective>

<execution_context>
@/Users/macuser/.claude/get-shit-done/workflows/execute-plan.md
@/Users/macuser/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-user-autonomy/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add branching_strategy to config template and validation schema</name>
  <files>
    /Users/macuser/.claude/get-shit-done/templates/config.json
    /Users/macuser/.claude/get-shit-done/lib/validate-config.md
  </files>
  <action>
    **Config template (`templates/config.json`):**
    Add `branching_strategy` field to the existing `git` section with default value `"none"`:
    ```json
    "git": {
      "auto_commit": true,
      "branching_strategy": "none"
    }
    ```

    **Validation schema (`lib/validate-config.md`):**

    1. Update the Git Section table to add the new field:
       ```
       | Field | Type | Required |
       |-------|------|----------|
       | `git.auto_commit` | boolean | No |
       | `git.branching_strategy` | string | No |
       ```

    2. Add field description after the table:
       - `git.branching_strategy` — Controls automatic branch creation during execution. Values: `"none"` (default, commit to current branch), `"phase"` (create `gsd/phase-{N}-{slug}` branch per phase), `"milestone"` (create `gsd/{version}-{slug}` branch per milestone). Set via `/gsd:settings`.

    3. Update the validation function's Git section to add enum validation after the existing `auto_commit` check:
       ```javascript
       // Git section
       if (config.git !== undefined) {
         if (checkType(config.git, 'object', 'git')) {
           checkType(config.git.auto_commit, 'boolean', 'git.auto_commit');
           checkEnum(config.git.branching_strategy, ['none', 'phase', 'milestone'], 'git.branching_strategy');
         }
       }
       ```
       Note: `checkEnum` already exists as a helper function in the validation code. Use it directly.
  </action>
  <verify>
    1. Read templates/config.json — verify `branching_strategy` field exists in git section with value `"none"`
    2. Read lib/validate-config.md — verify Git Section table has branching_strategy row
    3. Read lib/validate-config.md — verify field description explains all 3 values
    4. Read lib/validate-config.md — verify checkEnum call with ['none', 'phase', 'milestone'] exists in Git section
  </verify>
  <done>
    Config template includes git.branching_strategy with "none" default. Validation schema accepts "none", "phase", "milestone" as valid values and rejects anything else. Field description documents all three options.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add branching strategy question to settings UI</name>
  <files>
    /Users/macuser/.claude/commands/gsd/settings.md
  </files>
  <action>
    **Settings UI (`commands/gsd/settings.md`):**

    1. In Step 2 (Read Current Config), add to the parsed values list:
       - `git.branching_strategy` — branching approach (default: `"none"`)

    2. In Step 3 (Present Settings), add an 8th question AFTER the Auto-Commit question (question 5) and BEFORE the Interface Verification question (question 6). This keeps git settings grouped together. The new question becomes #6, pushing Interface Verification to #7 and Requirement Verification to #8:

       ```
       {
         question: "Git branching strategy?",
         header: "Git: Branching Strategy",
         multiSelect: false,
         options: [
           { label: "None (Recommended)", description: "Commit directly to current branch" },
           { label: "Per Phase", description: "Create gsd/phase-{N}-{name} branch for each phase" },
           { label: "Per Milestone", description: "Create gsd/{version}-{name} branch for entire milestone" }
         ]
       }
       ```

    3. Add response parsing for the new question (below existing auto-commit response parsing):
       ```
       Map branching strategy response to config enum:
       - "None" → "none"
       - "Per Phase" → "phase"
       - "Per Milestone" → "milestone"
       ```
       Pattern: `if response includes "Per Phase" → "phase", else if response includes "Per Milestone" → "milestone", else → "none"`

    4. Update Step 4 (Update Config) — add `branching_strategy` to the git section merge:
       ```json
       "git": {
         "auto_commit": true/false,
         "branching_strategy": "none" | "phase" | "milestone"
       }
       ```

    5. Update Step 5 (Confirm Changes) — add row to the confirmation table:
       ```
       | Branching Strategy   | {None/Per Phase/Per Milestone} |
       ```

    6. Update success_criteria to reflect 8 settings instead of 7:
       `- [ ] User presented with 8 settings (profile + 3 workflow toggles + 2 git toggles + 2 safety toggles)`
  </action>
  <verify>
    1. Read settings.md — verify 8 AskUserQuestion entries exist
    2. Read settings.md — verify branching strategy question is between Auto-Commit and Interface Verification
    3. Read settings.md — verify response parsing maps labels to "none"/"phase"/"milestone" enum values
    4. Read settings.md — verify config merge includes branching_strategy in git section
    5. Read settings.md — verify confirmation table includes Branching Strategy row
    6. Read settings.md — verify success criteria says "8 settings"
  </verify>
  <done>
    Settings UI presents branching strategy as the 6th question (grouped with auto-commit under Git). Response correctly maps to config enum values. Confirmation table shows selected strategy. Total settings count is 8.
  </done>
</task>

</tasks>

<verification>
1. Config template has `git.branching_strategy: "none"` field
2. Validation schema validates branching_strategy as enum with 3 allowed values
3. Settings UI has 8 questions total with branching strategy grouped with git settings
4. Response parsing correctly maps user selection to config enum
5. Confirmation table displays branching strategy choice
</verification>

<success_criteria>
- Config template includes git.branching_strategy with "none" default
- Validation rejects invalid branching_strategy values (e.g., "invalid")
- Validation accepts all 3 valid values: none, phase, milestone
- Settings UI shows branching strategy question with 3 options
- Selected strategy written to config.json git section
- Settings confirmation table includes branching strategy row
</success_criteria>

<output>
After completion, create `.planning/phases/03-git-branching/03-01-SUMMARY.md`
</output>
